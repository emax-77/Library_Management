{% extends 'base.html' %}
{% block content %}
<h1>Loans</h1>

<ul id="loan-list">
    {% for loan in loans %}
    <li>
        Book: "{{ loan.books.title }}" by {{ loan.books.author }}<br>
        Borrowed by: {{ loan.readers.first_name }} {{ loan.readers.last_name }} (ID: {{ loan.readers.id_number }})<br>
        Borrow Date: {{ loan.borrow_date }}{% if not loan.return_date %} - <strong>Not Returned</strong>{% else %} - Returned on: {{ loan.return_date }}{% endif %}
        
        {% if not loan.return_date %}
        <!-- Return Book Form -->
        <form method="POST" action="{{ url_for('book_return') }}" style="display: inline;">
            <input type="hidden" name="loan_id" value="{{ loan.id }}">
            <button type="submit">Return Book</button>
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>
<!-- Borrow a Book Form -->
<h2>Borrow a Book</h2>
<form method="POST" action="{{ url_for('loans_manage') }}">
    <label for="books_id">Select Book:</label>
    <select id="books_id" name="books_id" required>
        {% for book in available_books %}
        <option value="{{ book.id }}">{{ book.title }} by {{ book.author }}</option>
        {% endfor %}
    </select>

    <label for="readers_id">Select Reader:</label>
    <select id="readers_id" name="readers_id" required>
        {% for reader in readers %}
        <option value="{{ readers.id_number }}">{{ reader.first_name }} {{ reader.last_name }} (ID: {{ reader.id_number }})</option>
        {% endfor %}
    </select>

    <button type="submit">Borrow Book</button>
</form>
{% endblock %}
